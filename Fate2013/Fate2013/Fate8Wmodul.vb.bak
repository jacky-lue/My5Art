Module Fate8Wmodul
    '---------------------------------
    ' Ajack 2013 remake Fate program 
    ' Using VB express 2010 (free)
    '---------------------------------
    Public Structure GThG
        Public Gan As String
        Public Tsu As String
        Public hdG As String
        Public Sub clear()
            Gan = ""
            Tsu = ""
            hdG = ""
        End Sub
    End Structure

    Public Structure YearMonthDay
        Public Y As Integer
        Public M As Byte
        Public D As Byte
        Public Sub clear()
            Y = 0
            M = 0
            D = 0
        End Sub
    End Structure

    Public Structure PlaceLL
        Public LatDeg As Short
        Public LatMin As Byte
        Public LatSec As Byte
        Public LonDeg As Short
        Public LonMin As Byte
        Public LonSec As Byte
        Public Sub clear()
            'default 台灣台北市
            LatDeg = 25
            LatMin = 3
            LatSec = 23
            LonDeg = 121
            LonMin = 30
            LonSec = 15
        End Sub
    End Structure

    Public Structure JaChiDateTime
        Public Name As String
        Public YMD As YearMonthDay
        Public Hour As String
        Public Min As String
        Public Sub clear()
            Name = ""
            YMD.clear()
        End Sub
    End Structure

    Public Structure SenFu5Sing   '神輔與五行的各柱資料結構
        Public Gan As String
        Public Tsu As String
        Public HG1 As String
        Public HG2 As String
        Public HG3 As String
        Public Sub clear()
            Gan = ""
            Tsu = ""
            HG1 = ""
            HG2 = ""
            HG3 = ""
        End Sub
    End Structure

    Public Structure AllSenFu5Sing  '神輔與五行的八柱資料結構
        Public Ju As SenFu5Sing()
    End Structure

    Public Structure GwaInfo   '各柱的六十四卦資料
        Public UGwa As String
        Public DGwa As String
        Public UGwaNo As Integer
        Public DGwaNo As Integer
        Public GwaName As String
        Public GwaName2 As String
        Public Sub clear()
            UGwa = ""
            UGwaNo = 1
            DGwa = ""
            DGwaNo = 1
            GwaName = ""
            GwaName2 = ""
        End Sub
    End Structure

    Public Structure AllGwaInfo  '六十四卦的八柱資料結構
        Public Ju As GwaInfo()
    End Structure

    Public Structure All8Juinfo  '八柱資料結構
        Public Ju As String()
    End Structure

    Public Structure All8Ju12Koninfo  '八柱與十二宮資料結構
        Public Ju As String()
        Public Kon As String()
    End Structure

    Public Structure YellowGingType
        Public BornDate As Integer
        Public Passed As Integer
        Public NowDate As Integer
        Public Quadrant As Byte
        Public Sub clear()
            BornDate = 0
            Passed = 0
            NowDate = 0
            Quadrant = 1
        End Sub
    End Structure

    Public Structure typeBigYuan
        Public Gan As String           '干
        Public Tsu As String           '支
        Public YearsOld As Integer     '歲數
        Public Kon As String           '宮次
        Public LongLife As String      '長生
        Public SenFu As String         '神輔1
        Public SenFu12 As String       '神輔2
        Public Naing As String         '納音
        Public StarB2 As String        '星相
        Public Star As String          '星座
        Public Sub clear()
            Gan = ""
            Tsu = ""
            YearsOld = 0
            Kon = ""
            LongLife = ""
            SenFu = ""
            SenFu12 = ""
            Naing = ""
            StarB2 = ""
            Star = ""
        End Sub
    End Structure

    Public Structure Birth
        Public No As String            ' 編號
        Public EngMode As Boolean      ' 工程模式
        Public Age As integer          ' 批命時的年齡
        Public Name As String          ' 姓名
        Public Sex As String           ' 姓別(男 or 女)
        Public Solar As YearMonthDay   ' 西曆出生年月日
        Public SolarNextDay As YearMonthDay   ' 西曆出生年月日的隔天
        Public Lunar As YearMonthDay   ' 農曆出生年月日
        Public Lunar_IntercalaryMonth As Boolean '農曆月份是否閏月
        Public BornHour As Byte        ' 出生時
        Public BornMinute As Byte      ' 出生分
        Public BornPlace As PlaceLL    ' 出生地經緯度
        Public BornPlaceAddr As String ' 出生地
        Public SType As String         ' 陽年或陰年生
        Public Ju() As GThG            '八柱干支藏干
        Public PreJa As JaChiDateTime  '生辰之前的節
        Public NxtJa As JaChiDateTime  '生辰之後的節
        Public PreJC As JaChiDateTime  '生辰之前的節或氣
        Public SenFu As AllSenFu5Sing  '所有八柱的神輔
        Public WuSing As AllSenFu5Sing '所有八柱的五行
        Public NaIng As All8Juinfo  '所有八柱的納音五行
        Public Star As All8Juinfo   '所有八柱的星座 (天干)
        Public StarB As All8Juinfo  '所有八柱的星座B1 (地支,西洋星座)
        Public StarC As All8Juinfo  '所有八柱的星座C  (二十八星宿)
        Public MiKon As All8Juinfo  '所有八柱的所屬十二命宮
        Public SenSa As String(,)   '所有八柱的神煞
        Public Gwa As AllGwaInfo
        Public Kon12 As String()    '宮次
        Public Shan12 As String()   '限
        Public Yuan12 As String()   '運
        Public SenFu12 As String()  '神輔
        Public LongLife12 As All8Ju12Koninfo  '長生
        Public StarSky As String(,) '星際
        Public YearKing As String() '歲君
        Public StarB2 As String()   '十二宮星座
        Public Y60state As Byte(,)  '60年運線
        Public YellowGing As YellowGingType '黃經度
        Public BigYuan As typeBigYuan()     '運程
        Public BigYuanStarSky As String(,)  '運程的星際
        Public Ja2Born_D As Integer         ' 數至上/下個節氣有幾天幾時辰
        Public Ja2Born_H As Integer
        Public YuanStart As YearMonthDay    '上運距離的年月日
        Public YuanStartDate1 As String     '上運的西曆日期
        Public YuanStartDate2 As String     '上運的農曆日期
        Public YuanStart_YearGT As String   '上運年的干支
        Public YuanChange_YG As String      '每逢交脫的年
        Public YuanChange_M As String       '每逢交脫的月
        Public YuanChange_JC As String      '每逢交脫的節氣
        Public YuanChange_JCday As Integer  '每逢交脫的節氣後幾天
        Public WuSingState As String        '五行的旺相休囚死
        Public WuSingCount As Integer(,)    '五行的計數
        Public SenFuCount As Integer()      '神輔的計數
        Public DayStrongWeak As String   '日主強弱
        Public Main8wordKan As String    '八字取格(主要)
        Public Sub8wordKan1 As String    '八字取格(副1)
        Public Sub8wordKan2 As String    '八字取格(副2)
        Public Tsu3GroupType As String       '四柱地支有三合三會
        Public Tsu3Group5Sing As String      '三合三會的五行
        Public UsingGodMain As String    '用神(主要)
        Public UsingGodSub As String     '用神(次要)
        Public UsingGodNote As String    '用神提要
        Public YearEmpty As String     '年空亡
        Public DayEmpty As String      '日空亡

        Public Sub Initinal()
            ReDim Ju(8)
            ReDim SenFu.Ju(8)
            ReDim WuSing.Ju(8)
            ReDim NaIng.Ju(8)
            ReDim Gwa.Ju(8)
            ReDim Star.Ju(8)
            ReDim StarB.Ju(8)
            ReDim StarC.Ju(8)
            ReDim MiKon.Ju(8)
            ReDim Sensa(8, 14)
            ReDim Kon12(12)
            ReDim Shan12(12)
            ReDim Yuan12(12)
            ReDim SenFu12(12)
            ReDim LongLife12.Ju(8)    '八柱的長生
            ReDim LongLife12.Kon(12)  '十二宮的長生
            ReDim StarSky(12, 14)
            ReDim YearKing(12)
            ReDim StarB2(12)
            ReDim Y60state(10, 12)
            ReDim BigYuan(10)
            ReDim BigYuanStarSky(10, 14)
            ReDim WuSingCount(5, 2)
            ReDim SenFuCount(10)
        End Sub
        Public Sub Clear()
            No = "0"
            Name = ""
            Sex = ""
            Solar.clear()
            SolarNextDay.clear()
            Lunar.clear()
            BornHour = 0
            BornMinute = 0
            BornPlace.clear()
            BornPlaceAddr = ""
            SType = ""
            PreJa.clear()
            NxtJa.clear()
            PreJC.clear()
            Ja2Born_D = 0
            Ja2Born_H = 0
            YuanStart.clear()
            YuanStartDate1 = ""
            YuanStartDate2 = ""
            YuanStart_YearGT = ""
            YuanChange_YG = ""
            YuanChange_M = ""
            YuanChange_JC = ""
            YuanChange_JCday = 0
            WuSingState = ""
            DayStrongWeak = ""
            Main8wordKan = ""
            Sub8wordKan1 = ""
            Sub8wordKan2 = ""
            Tsu3GroupType = ""
            Tsu3Group5Sing = ""
            UsingGodMain = ""
            UsingGodSub = ""
            YearEmpty = ""
            DayEmpty = ""

            For i As Integer = 0 To 8   '------------
                Ju(i).clear()
                SenFu.Ju(i).clear()
                WuSing.Ju(i).clear()
                NaIng.Ju(i) = ""
                Star.Ju(i) = ""
                StarB.Ju(i) = ""
                StarC.Ju(i) = ""
                MiKon.Ju(i) = ""
                LongLife12.Ju(i) = ""
                Gwa.Ju(i).clear()
                For j As Integer = 0 To 14
                    SenSa(i, j) = ""
                Next
            Next
            For k As Integer = 0 To 12  '------------
                Kon12(k) = ""
                Shan12(k) = ""
                Yuan12(k) = ""
                SenFu12(k) = ""
                LongLife12.Kon(k) = ""
                YearKing(k) = ""
                StarB2(k) = ""
                For p As Integer = 0 To 10
                    Y60state(p, k) = 0
                Next
                For j As Integer = 0 To 14
                    StarSky(k, j) = ""
                Next
            Next
            For p As Integer = 0 To 10   '-----------
                BigYuan(p).clear()
                SenFuCount(p) = 0
                For j As Integer = 0 To 14
                    BigYuanStarSky(p, j) = ""
                Next
            Next
            For i As Integer = 0 To 5
                For j As Integer = 0 To 2
                    WuSingCount(i, j) = 0
                Next
            Next
        End Sub
    End Structure

    '宣告主要命造變數 PS:在主表單Load時,必須呼叫initinal()
    Public Bir As Birth

    Public Structure RelatedJC
        Public PreJa As JaChiDateTime  '日期之前的節
        Public NxtJa As JaChiDateTime  '日期之後的節
        Public PreJC As JaChiDateTime  '日期之前的節或氣
        Public changeMonth As boolean  '需要變換月份干支
    End Structure

    Public Function IsInGan(ByVal strG As String) As Boolean
        Dim strGan As String
        Dim pos As Integer
        strGan = "甲乙丙丁戊己庚辛壬癸"
        pos = InStr(strGan, strG)
        If pos = 0 Then
            IsInGan = False
        Else
            IsInGan = True
        End If
    End Function

    Public Function NextGan(ByVal strG As String) As String
        Dim strGan As String
        strGan = "甲乙丙丁戊己庚辛壬癸"
        ' 轉換下一個天干
        If strG = "癸" Then
            NextGan = "甲"
        Else
            NextGan = Mid(strGan, InStr(strGan, strG) + 1, 1)
        End If
    End Function

    Public Function PrevGan(ByVal strG As String) As String
        Dim strGan As String
        strGan = "癸壬辛庚己戊丁丙乙甲"
        ' 轉換前一個天干
        If strG = "甲" Then
            PrevGan = "癸"
        Else
            PrevGan = Mid(strGan, InStr(strGan, strG) + 1, 1)
        End If
    End Function

    Public Function IsInTsu(ByVal strT As String) As Boolean
        Dim strTsu As String
        Dim pos As Integer
        strTsu = "子丑寅卯辰巳午未申酉戌亥"
        pos = InStr(strTsu, strT)
        If pos = 0 Then
            IsInTsu = False
        Else
            IsInTsu = True
        End If
    End Function

    Public Function NextTsu(ByVal strT As String) As String
        Dim strTsu As String
        strTsu = "子丑寅卯辰巳午未申酉戌亥"
        ' 轉換下一個地支
        If strT = "亥" Then
            NextTsu = "子"
        Else
            NextTsu = Mid(strTsu, InStr(strTsu, strT) + 1, 1)
        End If
    End Function

    Public Function PrevTsu(ByVal strT As String) As String
        Dim strTsu As String
        strTsu = "亥戌酉申未午巳辰卯寅丑子"
        ' 轉換前一個地支
        If strT = "子" Then
            PrevTsu = "亥"
        Else
            PrevTsu = Mid(strTsu, InStr(strTsu, strT) + 1, 1)
        End If
    End Function

    Public Function DiffGT1Gt2(ByVal GT1_Gan As String, ByVal GT1_Tsu As String, _
                               ByVal GT2_Gan As String, ByVal GT2_Tsu As String) As Integer
        Dim Diff As Integer
        Diff = 0
        Do While GT2_Gan <> GT1_Gan Or GT2_Tsu <> GT1_Tsu
            'Move GT2 to next one
            GT2_Gan = NextGan(GT2_Gan)
            GT2_Tsu = NextTsu(GT2_Tsu)
            Diff = Diff + 1
        Loop

        DiffGT1Gt2 = Diff
    End Function

    '求干的五合------------------------------
    Public Function Gmatch(ByVal strGan As String) As String
        Select Case strGan
            Case "甲"
                Gmatch = "己"
            Case "乙"
                Gmatch = "庚"
            Case "丙"
                Gmatch = "辛"
            Case "丁"
                Gmatch = "壬"
            Case "戊"
                Gmatch = "癸"
            Case "己"
                Gmatch = "甲"
            Case "庚"
                Gmatch = "乙"
            Case "辛"
                Gmatch = "丙"
            Case "壬"
                Gmatch = "丁"
            Case "癸"
                Gmatch = "戊"
            Case Else        'dummy instuction
                Gmatch = "戊"
        End Select

    End Function

    '求支的六合------------------------------
    Public Function Tmatch(ByVal strTsu As String) As String
        Select Case strTsu
            Case "子"
                Tmatch = "丑"
            Case "丑"
                Tmatch = "子"
            Case "寅"
                Tmatch = "亥"
            Case "卯"
                Tmatch = "戌"
            Case "辰"
                Tmatch = "酉"
            Case "巳"
                Tmatch = "申"
            Case "午"
                Tmatch = "未"
            Case "未"
                Tmatch = "午"
            Case "申"
                Tmatch = "巳"
            Case "酉"
                Tmatch = "辰"
            Case "戌"
                Tmatch = "卯"
            Case "亥"
                Tmatch = "寅"
            Case Else         'dummy
                Tmatch = "寅"
        End Select
    End Function

    '求干支的五合六合(最合的干支)------------------------------
    Public Function GTMatch(ByVal strDayGanTsu As String) As String
        Dim strGan As String
        Dim strTsu As String
        strGan = Microsoft.VisualBasic.Left(strDayGanTsu, 1)
        strTsu = Microsoft.VisualBasic.Right(strDayGanTsu, 1)
        Select Case strGan
            Case "甲"
                strGan = "己"
            Case "乙"
                strGan = "庚"
            Case "丙"
                strGan = "辛"
            Case "丁"
                strGan = "壬"
            Case "戊"
                strGan = "癸"
            Case "己"
                strGan = "甲"
            Case "庚"
                strGan = "乙"
            Case "辛"
                strGan = "丙"
            Case "壬"
                strGan = "丁"
            Case "癸"
                strGan = "戊"
        End Select
        Select Case strTsu
            Case "子"
                strTsu = "丑"
            Case "丑"
                strTsu = "子"
            Case "寅"
                strTsu = "亥"
            Case "卯"
                strTsu = "戌"
            Case "辰"
                strTsu = "酉"
            Case "巳"
                strTsu = "申"
            Case "午"
                strTsu = "未"
            Case "未"
                strTsu = "午"
            Case "申"
                strTsu = "巳"
            Case "酉"
                strTsu = "辰"
            Case "戌"
                strTsu = "卯"
            Case "亥"
                strTsu = "寅"
        End Select
        GTMatch = strGan & strTsu
    End Function

    '五鼠遁
    Public Function WuSu(ByVal strTsu As String, ByVal strGan As String) As String
        Dim str10G As String
        Dim str12T As String
        Dim intAt As Integer
        str10G = "甲乙丙丁戊己庚辛壬癸甲乙丙丁戊己庚辛壬癸"
        str12T = "子丑寅卯辰巳午未申酉戌亥"
        intAt = InStr(str12T, strTsu)
        Select Case strGan
            Case "甲", "己"
                intAt = intAt
            Case "乙", "庚"
                intAt = intAt + 2
            Case "丙", "辛"
                intAt = intAt + 4
            Case "丁", "壬"
                intAt = intAt + 6
            Case "戊", "癸"
                intAt = intAt + 8
        End Select
        WuSu = Mid(str10G, intAt, 1)
    End Function

    ' 由 天干六神便訣、天干六神便訣 對照出的六神訣
    Public Function FindSixSen(ByVal strGan As String, ByVal strKey As String) As String
        Dim strMatch As String
        Dim arySixSen As String()
        Dim intAt As Integer
        strMatch = "甲乙丙丁戊己庚辛壬癸子丑寅卯辰巳午未申酉戌亥"
        Select Case strGan
            Case "甲"
                arySixSen = {"比肩", "劫財", "食神", "傷官", "偏財", "正財", "七殺", "正官", "偏印", "正印", "偏印", "正財", "比肩", "劫財", "偏財", "傷官", "食神", "正財", "七殺", "正官", "偏財", "正印"}
            Case "乙"
                arySixSen = {"劫財", "比肩", "傷官", "食神", "正財", "偏財", "正官", "七殺", "正印", "偏印", "正印", "偏財", "劫財", "比肩", "正財", "食神", "傷官", "偏財", "正官", "七殺", "正財", "偏印"}
            Case "丙"
                arySixSen = {"偏印", "正印", "比肩", "劫財", "食神", "傷官", "偏財", "正財", "七殺", "正官", "七殺", "傷官", "偏印", "正印", "食神", "劫財", "比肩", "傷官", "偏財", "正財", "食神", "正官"}
            Case "丁"
                arySixSen = {"正印", "偏印", "劫財", "比肩", "傷官", "食神", "正財", "偏財", "正官", "七殺", "正官", "食神", "正印", "偏印", "傷官", "比肩", "劫財", "食神", "正財", "偏財", "傷官", "七殺"}
            Case "戊"
                arySixSen = {"七殺", "正官", "偏印", "正印", "比肩", "劫財", "食神", "傷官", "偏財", "正財", "偏財", "劫財", "七殺", "正官", "比肩", "正印", "偏印", "劫財", "食神", "傷官", "比肩", "正財"}
            Case "己"
                arySixSen = {"正官", "七殺", "正印", "偏印", "劫財", "比肩", "傷官", "食神", "正財", "偏財", "正財", "比肩", "正官", "七殺", "劫財", "偏印", "正印", "比肩", "傷官", "食神", "劫財", "偏財"}
            Case "庚"
                arySixSen = {"偏財", "正財", "七殺", "正官", "偏印", "正印", "比肩", "劫財", "食神", "傷官", "食神", "正印", "偏財", "正財", "偏印", "正官", "七殺", "正印", "比肩", "劫財", "偏印", "傷官"}
            Case "辛"
                arySixSen = {"正財", "偏財", "正官", "七殺", "正印", "偏印", "劫財", "比肩", "傷官", "食神", "傷官", "偏印", "正財", "偏財", "正印", "七殺", "正官", "偏印", "劫財", "比肩", "正印", "食神"}
            Case "壬"
                arySixSen = {"食神", "傷官", "偏財", "正財", "七殺", "正官", "偏印", "正印", "比肩", "劫財", "比肩", "正官", "食神", "傷官", "七殺", "正財", "偏財", "正官", "偏印", "正印", "七殺", "劫財"}
            Case Else    '"癸"
                arySixSen = {"傷官", "食神", "正財", "偏財", "正官", "七殺", "正印", "偏印", "劫財", "比肩", "劫財", "七殺", "傷官", "食神", "正官", "偏財", "正財", "七殺", "正印", "偏印", "正官", "比肩"}
        End Select
        If strKey <> "" Then
            intAt = InStr(strMatch, strKey)
            FindSixSen = arySixSen(intAt - 1)
        Else
            FindSixSen = ""   '預設給空白的藏干
        End If
    End Function

    ' 把兩個字的神輔，轉為一個字的簡寫
    Public Function SF1word(ByVal strSenFu As String) As String
        Select Case strSenFu
            Case "比肩"
                SF1word = "比"
            Case "劫財"
                SF1word = "劫"
            Case "偏印"
                SF1word = "梟"
            Case "正印"
                SF1word = "印"
            Case "七殺"
                SF1word = "殺"
            Case "正官"
                SF1word = "官"
            Case "偏財"
                SF1word = "利"
            Case "正財"
                SF1word = "財"
            Case "食神"
                SF1word = "食"
            Case "傷官"
                SF1word = "傷"
            Case "天元"
                SF1word = "元"
            Case "元"
                SF1word = "元"
            Case Else   '若為空白輸出也空白
                SF1word = ""
        End Select
    End Function

    '求納音五行
    Public Function FindNaIng5Sing(ByVal str干 As String, ByVal str支 As String) As String
        Select Case str干 & str支
            Case "甲子", "乙丑"
                FindNaIng5Sing = "海中金"
            Case "丙寅", "丁卯"
                FindNaIng5Sing = "爐中火"
            Case "戊辰", "己巳"
                FindNaIng5Sing = "大林木"
            Case "庚午", "辛未"
                FindNaIng5Sing = "路旁土"
            Case "壬申", "癸酉"
                FindNaIng5Sing = "劍鋒金"
            Case "甲戌", "乙亥"
                FindNaIng5Sing = "山頭火"
            Case "丙子", "丁丑"
                FindNaIng5Sing = "澗下水"
            Case "戊寅", "己卯"
                FindNaIng5Sing = "城頭土"
            Case "庚辰", "辛巳"
                FindNaIng5Sing = "白臘金"
            Case "壬午", "癸未"
                FindNaIng5Sing = "楊柳木"
            Case "甲申", "乙酉"
                FindNaIng5Sing = "井泉水"
            Case "丙戌", "丁亥"
                FindNaIng5Sing = "屋上土"
            Case "戊子", "己丑"
                FindNaIng5Sing = "霹靂火"
            Case "庚寅", "辛卯"
                FindNaIng5Sing = "松柏木"
            Case "壬辰", "癸巳"
                FindNaIng5Sing = "長流水"
            Case "甲午", "乙未"
                FindNaIng5Sing = "沙中金"
            Case "丙申", "丁酉"
                FindNaIng5Sing = "山下火"
            Case "戊戌", "己亥"
                FindNaIng5Sing = "平地木"
            Case "庚子", "辛丑"
                FindNaIng5Sing = "壁上土"
            Case "壬寅", "癸卯"
                FindNaIng5Sing = "金箔金"
            Case "甲辰", "乙巳"
                FindNaIng5Sing = "覆燈火"
            Case "丙午", "丁未"
                FindNaIng5Sing = "天河水"
            Case "戊申", "己酉"
                FindNaIng5Sing = "大驛土"
            Case "庚戌", "辛亥"
                FindNaIng5Sing = "釵釧金"
            Case "壬子", "癸丑"
                FindNaIng5Sing = "桑拓木"
            Case "甲寅", "乙卯"
                FindNaIng5Sing = "大溪水"
            Case "丙辰", "丁巳"
                FindNaIng5Sing = "沙中土"
            Case "戊午", "己未"
                FindNaIng5Sing = "天上火"
            Case "庚申", "辛酉"
                FindNaIng5Sing = "石榴木"
            Case "壬戌", "癸亥"
                FindNaIng5Sing = "大海水"
            Case Else
                FindNaIng5Sing = "大海水"
        End Select
    End Function

    '求(各干支)的五行
    Public Function Find5Sing(ByVal StrGT As String) As String
        Dim strGTall As String = "甲乙丙丁戊己庚辛壬癸子丑寅卯辰巳午未申酉戌亥"
        Dim aryMatch As String() = New String() {"木+", "木-", "火+", "火-", "土+", "土-",
                    "金+", "金-", "水+", "水-", "水+", "土-", "木+", "木-", "土+", "火-", _
                         "火+", "土-", "金+", "金-", "土+", "水-"}
        If StrGT <> "" Then
            Find5Sing = aryMatch(InStr(strGTall, StrGT) - 1)
        Else
            Find5Sing = ""
        End If
    End Function

    '神煞總查詢 ----------------------------------------------
    '查詢一: 使用地支(十二宮次)查詢 strKey1=支
    '查詢二: 使用天干地支(八柱)查詢 strKey1=支 strKey2=干
    Public Function FindStarSky( _
        ByVal YearTsu As String, _
        ByVal MonthTsu As String, _
        ByVal DayGan As String, _
        ByVal strKey1 As String, Optional ByVal strKey2 As String = "") As String

        Dim strOut As String = ""
        Dim strKey As String
        Dim aryTmp As String() = {"", ""}
        Dim ALLTsu As String
        Dim strTmp As String

        'Step1 比對特有干支 -------------------------------------------------
        If strKey2 <> "" Then
            strKey = (strKey2 & strKey1)
            Select Case strKey
                Case "甲子", "甲辰", "甲寅", "丙戌", "丙寅"
                    strOut = strOut & "," & "平頭殺"
            End Select
            Select Case strKey
                Case "戊子", "己丑", "戊午", "己未", "丁未", "丙午"
                    strOut = strOut & "," & "六秀"
            End Select
            Select Case strKey
                Case "壬辰", "庚戌", "庚辰", "戊戌"
                    strOut = strOut & "," & "魁罡"
            End Select
            Select Case strKey
                Case "甲子", "甲午", "己卯"
                    strOut = strOut & "," & "進神"
            End Select
            Select Case strKey
                Case "己巳", "癸酉", "乙丑"
                    strOut = strOut & "," & "金神"
            End Select
            Select Case strKey
                Case "戊寅", "甲午", "戊申", "甲子"
                    strOut = strOut & "," & "天赦"
            End Select
        End If

        '-----原程式提前判斷此二者
        Select Case (DayGan & strKey1)
            Case "丙申", "戊申", "丁酉", "己酉", "壬寅", "癸卯"
                strOut = strOut & "," & "文昌"
        End Select
        strTmp = DayGan & strKey1
        If strTmp = "甲亥" Or strTmp = "乙戌" Or strTmp = "丙申" Or _
           strTmp = "丁未" Or strTmp = "戊申" Or strTmp = "己未" Or _
           strTmp = "庚巳" Or strTmp = "辛辰" Or strTmp = "壬寅" Or strTmp = "癸丑" Then
            strOut = strOut & "," & "暗祿"
        End If


        ' 查對一般神煞, 年支表--------------------------------------------------
        ALLTsu = "子丑寅卯辰巳午未申酉戌亥"
        Select Case YearTsu
            Case "子"
                aryTmp = {"金匱,將星,擎天,劍鋒", _
                         "玉堂,歲合,晦氣,天空,陰殺", _
                         "驛馬,孤辰,地喪", _
                         "大隨,紅鸞,羊刃,卒暴,三刑,貫索,勾紋,六厄", _
                         "金匱,三臺,官符,華蓋,披頭,飛符,黃番", _
                         "劫殺,月德,的殺,小耗,破碎", _
                         "紅艷,月空,大殺,天哭,囚獄", _
                         "紫微,地解,暴敗,天耗,天殺,歲殺,天厄,闌干", _
                         "急劫殺,白衣,指背,地殺,飛廉,大殺", _
                         "天喜,天德,福星,流霞,披麻,飛刃,年殺,卷舌,咸池", _
                         "八座,天解,解神,血刃,吞陷,豹尾,弔客,月殺,浮沈", _
                         "陌越,亡神,吞陷"}
            Case "丑"
                aryTmp = {"陌越,歲合,玉堂,孤虛", _
                         "黃番,劍鋒,華蓋,伏尸", _
                         "孤辰,紅鸞,劫殺,吞陷,天空,晦氣", _
                         "披頭,災殺,地喪,囚獄", _
                         "羊刃,勾絞,天殺,歲殺,貫索,卒暴", _
                         "飛符,金匱,三臺,地殺,官符,天哭,指背", _
                         "月殺,月德,咸池,小耗,年殺", _
                         "地解,大耗,破碎,豹尾,闌干", _
                         "貴人,紫微,天喜,紅艷,亡神,天厄,暴敗,天官符", _
                         "八座,天解,將星,解神,金匱,飛廉,大殺,浮沈,血刃", _
                         "天德,福星,三型,板鞍,卷舌,寡宿", _
                         "天馬,弔客"}
            Case "寅"
                aryTmp = {"引客,災殺", _
                         "陌越,紅鸞,天醫,吞陷,寡宿,天殺", _
                         "指背,劍鋒,披麻,地殺", _
                         "天空,咸池,年殺", _
                         "地喪,天哭,豹尾,月殺", _
                         "勾絞,孤辰,貫索,亡神", _
                         "三臺,金匱,將星,官符,飛符", _
                         "月德,天喜,板鞍,小耗", _
                         "八座,天馬,天解,解神,地解,闌干,破碎,血刃,浮沈", _
                         "紫微,暴敗,天厄,六害", _
                         "黃番,華蓋,飛廉,大殺,", _
                         "歲合,天德,福星,劫殺,吞卷,絞煞"}
            Case "卯"
                aryTmp = {"天德,紅鸞,福星,咸池,卷舌,年刑", _
                         "寡宿,天解,八座,披頭,飛刃,月殺,弔客,", _
                         "陌越,亡神,天官符", _
                         "天殺,金匱,將星,天哭,劍鋒,伏日", _
                         "攀鞍,陰殺,天空,晦氣", _
                         "孤辰,驛馬,的殺,地喪,破碎", _
                         "天嘉,六厄,匱素,勾絞,六害", _
                         "黃番,天解,三臺,解神,華蓋,羊刃,浮沈,血刃,飛符", _
                         "月德,地解,小耗,釗殺", _
                         "歲殺,月空,闌干,災殺,大耗", _
                         "紫微,暴敗,天厄,天殺", _
                         "天殺,地殺"}
            Case "辰"
                aryTmp = {"飛刃,金匱,將星,飛廉,天殺,披頭", _
                         "福星,天德,的殺,卷吞,陰殺,寡宿", _
                         "驛馬,弔客,天哭", _
                         "陌越,六害", _
                         "吞陷,劍鋒,華蓋,黃番,伏尸", _
                         "天解,天喜,劫殺,天空,流霞,孤辰,晦氣", _
                         "災殺,八座,解神,浮沈,地喪,血刃,羊刃", _
                         "卒暴,歲殺,天殺,貫索,勾絞,囚獄", _
                         "披麻,三臺,飛符,官符,地殺,指背", _
                         "地殺,歲合,月德,咸池,年殺,小耗", _
                         "破碎,月空,闌干,月殺,豹尾,大耗", _
                         "紫微,地解,紅鸞,暴敗,天厄,亡神,天官符"}
            Case "巳"
                aryTmp = {"地解,玉堂,紫微,天厄,六害,暴敗,六厄", _
                         "飛廉,黃番,大殺,華蓋,羊刃", _
                         "天德,福星,卷舌,天哭,劫殺", _
                         "弔客,八座,天殺,吞陷,急腳殺", _
                         "陌越,天喜,天解,囚獄,天殺,寡宿,歲殺,紅艷", _
                         "伏尸,解神,浮沈,劍鋒,血刃,指背", _
                         "年殺,咸池,天空,晦氣,流霞", _
                         "月殺,豹尾,地喪,羊刃", _
                         "歲合,貴人,勾絞,歲刑,天官,卒暴,亡神,貫索,天官符", _
                         "將星,三臺,金匱,飛符,的殺,官符,陰殺", _
                         "紅鸞,月德,攀鞍,小耗", _
                         "破碎,驛馬,月空,披頭,大耗,闌干"}
            Case "午"
                aryTmp = {"破碎,月空,闌干,災殺,歲殺,天哭,大耗", _
                         "紫微,地解,吞陷,暴敗,天厄,歲殺,天殺,埋兒殺", _
                         "指背,大殺,地殺,飛廉,天雞", _
                         "天德,福星,天喜,咸池,年殺,卷吞,披麻", _
                         "解神,天解,八座,寡宿,豹尾,浮沈,月殺,弔客", _
                         "亡神,陌越,急腳,天官,腳殺,官符,破碎,的殺", _
                         "金匱,將星,劍鋒,伏尸", _
                         "歲合,攀鞍,天空,月殺,晦氣", _
                         "驛馬,孤辰,地喪", _
                         "紅鸞,卒暴,三刑,貫素,勾絞,六害,羊刃", _
                         "三臺,黃番,飛符,官符,華蓋,披頭", _
                         "月德,劫殺,小耗"}
            Case "未"
                aryTmp = {"月德,小耗,咸池,年殺", _
                         "闌干,月空,大耗,的殺,月殺,豹尾", _
                         "地解,紫微,天喜,暴敗,天官符,亡神,天厄,吞陷", _
                         "金匱,天解,解神,將神,飛廉,大殺,浮沈,血刃", _
                         "福星,天德,攀鞍,飛刃,陰殺,卷舌,披頭,寡宿", _
                         "八座,驛馬,弔客", _
                         "陌越,玉堂,歲合,六合", _
                         "華蓋,黃番,劍鋒,伏尸", _
                         "紅鸞,孤辰,劫殺,天空", _
                         "披頭,災殺,地殺,囚獄", _
                         "羊刃,勾紋,貫索", _
                         "三臺,飛符,地殺,官符,天哭,指背"}
            Case "申"
                aryTmp = {"將星,三臺,金匱,飛符,官符", _
                         "月德,天喜,攀鞍,陰殺,小耗", _
                         "驛馬,月空,天解,解神,歲刑,破碎,大耗,浮沈,羊刃", _
                         "紫微,玉堂,地解,天殺,六害,闌干,暴敗,天厄", _
                         "飛廉,大殺,華蓋,黃番", _
                         "天德,貴人,歲合,福星,劫殺,卷舌,披麻", _
                         "八座,弔客,囚獄,災殺", _
                         "陌越,紅鸞,歲殺,天殺,宿寡", _
                         "劍鋒,指背,地殺,披頭,伏尸", _
                         "咸池,晦氣,天空", _
                         "豹尾,天哭,月殺,地喪,吞陷", _
                         "貫索,地解,孤辰,勾絞,亡神,卒暴,官符"}
            Case "酉"
                aryTmp = {"六害,天喜,貫索,勾絞,卒暴,六厄", _
                         "天解,解神,三臺,浮沈,飛符,黃番,官符,華蓋,血刃", _
                         "月德,劫殺,死殺,小耗", _
                         "月空,闌干,大耗,破碎,災殺,囚獄", _
                         "歲合,紫微,地解,天厄,歲殺,天殺,暴敗", _
                         "飛廉,地殺,大殺", _
                         "紅鸞,福星,天德,咸池,年殺,卷舌,披麻", _
                         "披頭,八座,寡宿,月殺,弔客,豹尾", _
                         "陌越,天官符,亡神", _
                         "將星,金匱,劍鋒,天哭,伏尸", _
                         "披頭,陰殺,吞陷,天空,晦氣", _
                         "驛馬,孤辰,地喪"}
            Case "戌"
                aryTmp = {"天解,八座,解神,災殺,地喪,浮沈,羊刃", _
                         "年殺,天殺,卒暴,勾絞", _
                         "吞陷,三臺,飛符,地殺,官符,指背", _
                         "月德,歲合,咸池,年殺,小耗", _
                         "闌干,月空,破碎,豹尾,月殺,大耗", _
                         "紅鸞,紫微,天官符,亡神,天厄,暴敗", _
                         "地解,將星,金匱,大殺,披頭", _
                         "天德,福星,寡宿,歲刑,卷舌", _
                         "天馬,弔客,天哭", _
                         "陌越,六害", _
                         "伏尸,劍鋒,黃番,華蓋", _
                         "天喜,孤辰,天空,劫殺"}
            Case "亥"
                aryTmp = {"咸池,年殺,天空,晦氣,擎天", _
                         "卒暴,豹尾,月殺,地喪,貫索", _
                         "歲合,孤辰,勾絞,亡神,天官符", _
                         "金匱,三臺,將星,飛廉,披頭,官符", _
                         "紅鸞,月德,攀鞍,陰殺,小耗", _
                         "驛馬,月空,大耗,披頭,破碎", _
                         "紫微,遊奕,六害,天厄,暴敗", _
                         "華蓋,飛廉,黃番,天哭,大殺", _
                         "天德,福星,劫殺,披麻,卷舌", _
                         "天解,八座,囚獄,弔客,夾殺", _
                         "陌越,天喜,歲殺,天殺,寡宿", _
                         "指背,解神,血刃,浮沈,地殺,伏尸"}
        End Select
        strOut = strOut & "," & aryTmp(InStr(ALLTsu, strKey1) - 1)

        ' 日干表 ------------------------------------------------------------------
        strKey = DayGan & strKey1
        Select Case strKey
            Case "甲寅", "乙卯", "丙巳", "丁午", "戊巳", "己午", "庚申", "辛酉", "壬亥", "癸子"
                strOut = strOut & "," & "祿神"
        End Select
        Select Case strKey
            Case "甲丑", "乙子", "丙亥", "丁亥", "戊丑", "己子", "庚丑", "辛午", "壬巳", "癸巳"
                strOut = strOut & "," & "天乙貴人"
        End Select
        Select Case strKey
            Case "甲未", "乙申", "丙酉", "丁酉", "戊未", "己申", "庚未", "辛寅", "壬卯", "癸卯"
                strOut = strOut & "," & "天乙貴人"
        End Select
        Select Case strKey
            Case "甲卯", "乙辰", "丙午", "丁未", "戊午", "己未", "庚酉", "辛戌", "壬子", "癸丑"
                strOut = strOut & "," & "陽刃"
        End Select
        Select Case strKey
            Case "甲亥", "乙午", "丙寅", "丁酉", "戊寅", "己酉", "庚巳", "辛子", "壬申", "癸卯"
                strOut = strOut & "," & "學堂"
        End Select
        Select Case strKey
            Case "甲午", "甲申", "乙午", "乙申", "丙寅", "丁未", "戊辰", "己辰", "庚申", "庚戌", "辛酉", "壬子", "癸申"
                strOut = strOut & "," & "紅豔"
        End Select
        Select Case strKey
            Case "甲酉", "乙戌", "丙未", "丁申", "戊巳", "己午", "庚辰", "辛卯", "壬亥", "癸寅"
                strOut = strOut & "," & "流霞"
        End Select
        Select Case strKey
            Case "甲辰", "乙己", "丙未", "丁申", "戊未", "己申", "庚戌", "辛亥", "壬丑", "癸寅"
                strOut = strOut & "," & "金與"
        End Select
        Select Case strKey
            Case "甲酉", "乙戌", "丙子", "丁丑", "戊子", "己丑", "庚卯", "辛辰", "壬午", "癸未"
                strOut = strOut & "," & "飛刃"
        End Select
        Select Case strKey
            Case "甲酉", "乙戌", "丙子", "丁丑", "戊子", "己丑", "庚卯", "辛辰", "壬午", "癸未"
                strOut = strOut & "," & ""
        End Select

        If Right(strOut, 1) = "," Then
            strOut = Microsoft.VisualBasic.Left(strOut, Len(strOut) - 1)
        End If

        ' 月支表-------------------------------------------------------------------------
        strKey = MonthTsu & strKey1
        Select Case strKey
            Case "寅丁", "卯申", "辰壬", "巳辛", "午亥", "未甲", "申癸", "酉寅", "戌丙", "亥乙", "子己", "丑庚"
                strOut = strOut & "," & "天德"
        End Select
        Select Case strKey
            Case "寅丙", "卯甲", "辰壬", "巳庚", "午丙", "未甲", "申壬", "酉庚", "戌丙", "亥甲", "子壬", "丑庚"
                strOut = strOut & "," & "月德"
        End Select
        Select Case strKey
            Case "寅丑", "卯未", "辰寅", "巳申", "午卯", "未酉", "申辰", "酉戌", "戌巳", "亥亥", "子午", "丑子"
                strOut = strOut & "," & "血刃"
        End Select

        ' 年支表
        strKey = YearTsu & strKey1
        Select Case strKey
            Case "子辰", "丑丑", "寅戌", "卯未", "辰辰", "己丑", "午戌", "未未", "申辰", "酉丑", "戌戌", "亥未"
                strOut = strOut & "," & "華蓋"
        End Select
        Select Case strKey
            Case "子子", "丑酉", "寅午", "卯卯", "辰子", "己酉", "午午", "未卯", "申子", "酉酉", "戌午", "亥卯"
                strOut = strOut & "," & "將星"
        End Select
        Select Case strKey
            Case "子寅", "丑亥", "寅申", "卯巳", "辰寅", "己亥", "午申", "未巳", "申寅", "酉亥", "戌申", "亥巳"
                strOut = strOut & "," & "驛馬"
        End Select
        Select Case strKey
            Case "子酉", "丑午", "寅卯", "卯子", "辰酉", "己午", "午卯", "未子", "申酉", "酉午", "戌卯", "亥子"
                strOut = strOut & "," & "桃花"
        End Select
        Select Case strKey
            Case "子戌", "丑酉", "寅申", "卯未", "辰午", "己巳", "午辰", "未卯", "申寅", "酉丑", "戌子", "亥亥"
                strOut = strOut & "," & "血刃"
        End Select
        Select Case strKey
            Case "子寅", "丑寅", "寅巳", "卯巳", "辰巳", "己申", "午申", "未申", "申亥", "酉亥", "戌亥", "亥寅"
                strOut = strOut & "," & "孤神"
        End Select
        Select Case strKey
            Case "子戌", "丑戌", "寅丑", "卯丑", "辰丑", "己辰", "午辰", "未辰", "申未", "酉未", "戌未", "亥戌"
                strOut = strOut & "," & "寡宿"
        End Select
        Select Case strKey
            Case "子寅", "丑卯", "寅辰", "卯巳", "辰午", "己未", "午申", "未酉", "申戌", "酉亥", "戌子", "亥丑"
                strOut = strOut & "," & "喪門"
        End Select
        Select Case strKey
            Case "子戌", "丑亥", "寅子", "卯丑", "辰寅", "己卯", "午辰", "未巳", "申午", "酉未", "戌申", "亥酉"
                strOut = strOut & "," & "弔客"
        End Select
        Select Case strKey
            Case "子巳", "丑寅", "寅亥", "卯申", "辰巳", "己寅", "午亥", "未申", "申巳", "酉寅", "戌亥", "亥申"
                strOut = strOut & "," & "劫煞"
        End Select
        Select Case strKey
            Case "子戌", "丑酉", "寅申", "卯未", "辰午", "己巳", "午辰", "未卯", "申寅", "酉丑", "戌子", "亥亥"
                strOut = strOut & "," & "血支"
        End Select
        Select Case strKey
            Case "子巳", "丑丑", "寅酉", "卯巳", "辰丑", "己酉", "午巳", "未丑", "申酉", "酉巳", "戌丑", "亥酉"
                strOut = strOut & "," & "太白凶星"
        End Select

        If Left(strOut, 1) = "," Then
            strOut = Mid(strOut, 2)
        End If

        '=================== end ==================
        FindStarSky = strOut
        '巳戌巳戌寅戌寅戌酉寅子辰子 丑丙丁寅
        '丑酉寅亥卯戌寅酉午亥酉丑丑 未甲申卯
        '酉申亥子辰丑巳申卯申午戌寅 寅壬壬辰
        '巳未申丑巳丑巳未子巳卯未卯 申庚辛巳
        '丑午巳寅午丑巳午酉寅子辰辰 卯丙亥午
        '酉巳寅卯未辰申巳午亥酉丑己 酉甲甲未
        '巳辰亥辰申辰申辰卯申午戌午 辰壬癸申
        '丑卯申巳酉辰申卯子巳卯未未 戌庚寅酉
        '酉寅巳午戌未亥寅酉寅子辰申 巳丙丙戌
        '巳丑寅未亥未亥丑午亥酉丑酉 亥甲乙亥
        '丑子亥申子未亥子卯申午戌戌 午壬己子
        '酉亥申酉丑戌寅亥子巳卯未亥 子庚庚丑
    End Function
    Public Function To12Hour(ByVal In24Hour As Byte) As Byte
        If (In24Hour Mod 2) = 0 Then
            '偶數
            To12Hour = In24Hour
        Else
            '奇數
            To12Hour = In24Hour + 1
        End If
    End Function

    '整數轉換成中文數字, 至多3位數, 不含百與十
    Public Function ToChNo(ByVal IntNo As Integer) As String
        Dim strChNoAll As String() = {"零", "一", "二", "三", "四", "五", "六", "七", "八", "九"}
        Dim Dvr As Integer
        Dim work As Integer
        Dim AnsStr As String = ""
        Dim ThreeNum As Boolean = False
        work = IntNo
        If work > 100 Then
            ThreeNum = True
            Dvr = work \ 100
            work = work - (Dvr * 100)
            AnsStr = AnsStr & strChNoAll(Dvr)
        End If
        If ThreeNum Then
            If work > 10 Then
                Dvr = work \ 10
                work = work - (Dvr * 10)
                AnsStr = AnsStr & strChNoAll(Dvr)
            Else
                AnsStr = AnsStr & strChNoAll(0)
            End If
        Else
            'only two digit
            If work > 10 Then
                Dvr = work \ 10
                work = work - (Dvr * 10)
                AnsStr = AnsStr & strChNoAll(Dvr)
            End If
        End If
        AnsStr = AnsStr & strChNoAll(work)
        ToChNo = AnsStr
    End Function
    Public Function ToChineseNo(ByVal IntNo As Integer) As String
        Dim strChNoAll As String() = {"零", "一", "二", "三", "四", "五", "六", "七", "八", "九", "十", "百"}
        Dim Dvr As Integer
        Dim work As Integer
        Dim AnsStr As String = ""
        Dim ThreeNum As Boolean = False
        work = IntNo
        If work > 100 Then
            ThreeNum = True
            Dvr = work \ 100
            work = work - (Dvr * 100)
            AnsStr = AnsStr & strChNoAll(Dvr) & strChNoAll(11)
        End If
        If ThreeNum Then
            If work > 10 Then
                Dvr = work \ 10
                work = work - (Dvr * 10)
                AnsStr = AnsStr & strChNoAll(Dvr) & strChNoAll(10)
            Else
                AnsStr = AnsStr & strChNoAll(0)
            End If
        Else
            'only two digit
            If work > 10 Then
                Dvr = work \ 10
                work = work - (Dvr * 10)
                If (Dvr > 1) Then
                    AnsStr = AnsStr & strChNoAll(Dvr) & strChNoAll(10)
                Else
                    AnsStr = AnsStr & strChNoAll(10)
                End If
            End If
        End If
        AnsStr = AnsStr & strChNoAll(work)
        ToChineseNo = AnsStr
    End Function

    '檢查三合三會, 輸入為地支四字
    ' Input : InString 為地支四字
    ' Function return 是不是三合或三會 (False/True)
    ' Extra return:
    '         ReCode = 0  : 輸入有非地支之字
    '                = 1  : 輸入無錯誤
    '                = 21,22,23,24 : 三合水,火,木,金
    '                = 31,32,33,34 : 三會水,火,木,金
    '                = 4  : 沖破
    Public Function Is3Group(ByVal InString As String, _
                            ByRef ReCode As Integer, _
                            ByRef GroupType As String, _
                            ByRef Group5Sing As String) As Boolean
        '三合
        Dim Gstring21 As String = "申子辰"
        Dim Gstring22 As String = "寅午戌"
        Dim Gstring23 As String = "亥卯未"
        Dim Gstring24 As String = "巳酉丑"
        '三會
        Dim Gstring31 As String = "亥子丑"
        Dim Gstring32 As String = "巳午未"
        Dim Gstring33 As String = "寅卯辰"
        Dim Gstring34 As String = "申酉戌"

        '檢查輸入
        For i As Integer = 1 To Len(InString)
            If IsInTsu(Mid(InString, i, 1)) = False Then
                ReCode = 0 : GroupType = "" : Group5Sing = ""
                Is3Group = False
                Exit Function
            End If
        Next
        '----------------
        ReCode = 1 : GroupType = "" : Group5Sing = ""
        Is3Group = False
        'check 21 -------  "申子辰"
        If InStr(InString, Mid(Gstring21, 1, 1)) Then  '有第一字
            If InStr(InString, Mid(Gstring21, 2, 1)) Then  '有第二字
                If InStr(InString, Mid(Gstring21, 3, 1)) Then  '有第三字
                    GroupType = "申子辰" : Group5Sing = "水"
                    '是否沖破?
                    If InStr(InString, Mid(Gstring22, 1, 1)) Or _
                        InStr(InString, Mid(Gstring22, 2, 1)) Or _
                        InStr(InString, Mid(Gstring22, 3, 1)) Then
                        ReCode = 4
                        Is3Group = False
                    Else
                        ReCode = 21
                        Is3Group = True
                    End If  '沖破
                End If   '3
            End If    '2
        End If    '1
        'check 22 ------- "寅午戌"
        If InStr(InString, Mid(Gstring22, 1, 1)) Then  '有第一字
            If InStr(InString, Mid(Gstring22, 2, 1)) Then  '有第二字
                If InStr(InString, Mid(Gstring22, 3, 1)) Then  '有第三字
                    GroupType = "寅午戌" : Group5Sing = "火"
                    '是否沖破?
                    If InStr(InString, Mid(Gstring21, 1, 1)) Or _
                        InStr(InString, Mid(Gstring21, 2, 1)) Or _
                        InStr(InString, Mid(Gstring21, 3, 1)) Then
                        ReCode = 4
                        Is3Group = False
                    Else
                        ReCode = 22
                        Is3Group = True
                    End If  '沖破
                End If   '3
            End If    '2
        End If    '1
        'check 23 -------  "亥卯未"
        If InStr(InString, Mid(Gstring23, 1, 1)) Then  '有第一字
            If InStr(InString, Mid(Gstring23, 2, 1)) Then  '有第二字
                If InStr(InString, Mid(Gstring23, 3, 1)) Then  '有第三字
                    GroupType = "亥卯未" : Group5Sing = "木"
                    '是否沖破?
                    If InStr(InString, Mid(Gstring24, 1, 1)) Or _
                        InStr(InString, Mid(Gstring24, 2, 1)) Or _
                        InStr(InString, Mid(Gstring24, 3, 1)) Then
                        ReCode = 4
                        Is3Group = False
                    Else
                        ReCode = 23
                        Is3Group = True
                    End If  '沖破
                End If   '3
            End If    '2
        End If    '1
        'check 24 ------- "巳酉丑"
        If InStr(InString, Mid(Gstring24, 1, 1)) Then  '有第一字
            If InStr(InString, Mid(Gstring24, 2, 1)) Then  '有第二字
                If InStr(InString, Mid(Gstring24, 3, 1)) Then  '有第三字
                    GroupType = "巳酉丑" : Group5Sing = "金"
                    '是否沖破?
                    If InStr(InString, Mid(Gstring23, 1, 1)) Or _
                        InStr(InString, Mid(Gstring23, 2, 1)) Or _
                        InStr(InString, Mid(Gstring23, 3, 1)) Then
                        ReCode = 4
                        Is3Group = False
                    Else
                        ReCode = 24
                        Is3Group = True
                    End If  '沖破
                End If   '3
            End If    '2
        End If    '1
        '===========================
        'check 31 -------  "亥子丑"
        If InStr(InString, Mid(Gstring31, 1, 1)) Then  '有第一字
            If InStr(InString, Mid(Gstring31, 2, 1)) Then  '有第二字
                If InStr(InString, Mid(Gstring31, 3, 1)) Then  '有第三字
                    GroupType = "亥子丑" : Group5Sing = "水"
                    '是否沖破?
                    If InStr(InString, Mid(Gstring32, 1, 1)) Or _
                        InStr(InString, Mid(Gstring32, 2, 1)) Or _
                        InStr(InString, Mid(Gstring32, 3, 1)) Then
                        ReCode = 4
                        Is3Group = False
                    Else
                        ReCode = 31
                        Is3Group = True
                    End If  '沖破
                End If   '3
            End If    '2
        End If    '1
        'check 32 ------- "巳午未"
        If InStr(InString, Mid(Gstring32, 1, 1)) Then  '有第一字
            If InStr(InString, Mid(Gstring32, 2, 1)) Then  '有第二字
                If InStr(InString, Mid(Gstring32, 3, 1)) Then  '有第三字
                    GroupType = "巳午未" : Group5Sing = "火"
                    '是否沖破?
                    If InStr(InString, Mid(Gstring31, 1, 1)) Or _
                        InStr(InString, Mid(Gstring31, 2, 1)) Or _
                        InStr(InString, Mid(Gstring31, 3, 1)) Then
                        ReCode = 4
                        Is3Group = False
                    Else
                        ReCode = 32
                        Is3Group = True
                    End If  '沖破
                End If   '3
            End If    '2
        End If    '1
        'check 33 -------  "寅卯辰"
        If InStr(InString, Mid(Gstring33, 1, 1)) Then  '有第一字
            If InStr(InString, Mid(Gstring33, 2, 1)) Then  '有第二字
                If InStr(InString, Mid(Gstring33, 3, 1)) Then  '有第三字
                    GroupType = "寅卯辰" : Group5Sing = "木"
                    '是否沖破?
                    If InStr(InString, Mid(Gstring34, 1, 1)) Or _
                        InStr(InString, Mid(Gstring34, 2, 1)) Or _
                        InStr(InString, Mid(Gstring34, 3, 1)) Then
                        ReCode = 4
                        Is3Group = False
                    Else
                        ReCode = 33
                        Is3Group = True
                    End If  '沖破
                End If   '3
            End If    '2
        End If    '1
        'check 34 ------- "申酉戌"
        If InStr(InString, Mid(Gstring34, 1, 1)) Then  '有第一字
            If InStr(InString, Mid(Gstring34, 2, 1)) Then  '有第二字
                If InStr(InString, Mid(Gstring34, 3, 1)) Then  '有第三字
                    GroupType = "申酉戌" : Group5Sing = "金"
                    '是否沖破?
                    If InStr(InString, Mid(Gstring33, 1, 1)) Or _
                        InStr(InString, Mid(Gstring33, 2, 1)) Or _
                        InStr(InString, Mid(Gstring33, 3, 1)) Then
                        ReCode = 4
                        Is3Group = False
                    Else
                        ReCode = 34
                        Is3Group = True
                    End If  '沖破
                End If   '3
            End If    '2
        End If    '1
    End Function

    '求空亡
    Public Function FindEmpty(ByVal str干 As String, ByVal str支 As String) As String
        Select Case str干 & str支
            Case "甲子", "乙丑", "丙寅", "丁卯", "戊辰", "己巳", "庚午", "辛未", "壬申", "癸酉"
                FindEmpty = "戌亥"
            Case "甲戌", "乙亥", "丙子", "丁丑", "戊寅", "己卯", "庚辰", "辛巳", "壬午", "癸未"
                FindEmpty = "申酉"
            Case "甲申", "乙酉", "丙戌", "丁亥", "戊子", "己丑", "庚寅", "辛卯", "壬辰", "癸巳"
                FindEmpty = "午未"
            Case "甲午", "乙未", "丙申", "丁酉", "戊戌", "己亥", "庚子", "辛丑", "壬寅", "癸卯"
                FindEmpty = "辰巳"
            Case "甲辰", "乙巳", "丙午", "丁未", "戊申", "己酉", "庚戌", "辛亥", "壬子", "癸丑"
                FindEmpty = "寅卯"
            Case "甲寅", "乙卯", "丙辰", "丁巳", "戊午", "己未", "庚申", "辛酉", "壬戌", "癸亥"
                FindEmpty = "子丑"
            Case Else
                FindEmpty = "錯誤"
        End Select
    End Function
End Module
